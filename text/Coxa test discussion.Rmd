---
title: "Coxa measurement text EDA"
author: "Alex Reich"
date: "2025-10-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(knitr)
library(tidyverse)
library(kableExtra)
```

Todo
-look at the false positive from 32mm plz

# Overview
In addition to the base data for the Crab Allometry Project (where we measured coxa width, carapace width, and carapace length), Chris took some test measurements with tools set at 31mm, 32mm, and 33mm. With these tools, could we correctly identify legal and sublegal crab size?

# Methods
This test was conducted twice, with notably different methodology and datasheet structures. Test 1 was conducted in June 2025 in St. James Bay. Coxa width thresholds of 31mm and 32mm were tested and the carapace width was recorded. Test 1 measured 74 crab, 52 at the test coxa width of 31mm and 22 crab at the test coxa width of 32mm. A male crab of width 178mm (7 inches) or greater is a legal crab. Test 2 was conducted in July 2025 in the Juneau Area. Coxa width thresholds of 31mm, 32mm, and 33mm were tested, and the carapace length was recorded, but not the carapace width. In Test 2, the stick.legal column indicates legality, that the crab is 178mm or wider. In Test 2, 146 crab were measured, all at the 31mm, 32mm, and 33mm coxa thresholds. Some data wrangling was required in order to get these two datasets together for graphing.

Some notable column metadata:
- Stick.legal indicates if the crab is legal width, as measured by the 7in (178mm) width stick.
- Coxa.legal indicates if the crab is legal or not as determined by the coxa width. This is the test measurement.

I was primarily interested in false positives. It would not be great if the troopers cited someone for harvesting a legal crab. I also calculated true positives, true negatives, and false negatives.

## Data wrangling
I combined the two datasets into one master dataset per test measurement (31mm, 32mm, 33mm) with the following columns: Location, Stick.legal, Coxa.legal. 
# Results
A coxa test width of 31mm was the most conservative test width, getting right 64.2% of measured crab, with no false positives (Figure 1, Table 1). Coxa test width 32mm had one false positive and correctly identified legal size in 75.5% of the crab (Figure 2, Table 2). Coxa test width of 33mm was the most accurate at 85.6% correct identification of legal crab, but 10.3% of the missed calls were false positives, the least desirable missed call (when the crab is actually legal but the coxa width informs that it is not; Figure 3, Table 3). So choosing a threshold of 31mm would be on the conservative size, calling some crab legal that are too small, but not erroneously punishing anyone who harvested a legal size crab. Choosing a threshold of 32mm would be a more accurate threshold, with a small but notable risk of false positives (1.52% false positve rate with 32mm threshold in this study). I'd advise against 33mm as the coxa width test measurement; a false positive rate of 10% is too high.

#Tables


```{r Table 1}
d <- read.csv("../results/coxa test 31.csv")

kable(d, caption = "Test coxa measurement of 31mm")
```

```{r Table 2}
d <- read.csv("../results/coxa test 32.csv")

kable(d, caption = "Test coxa measurement of 32mm")
```


```{r Table 3}
d <- read.csv("../results/coxa test 33.csv")

kable(d, caption = "Test coxa measurement of 33mm")
```


# Figures

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
